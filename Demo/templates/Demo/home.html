{% extends "Demo/base.html" %}

{% block title %} Dashboard {% endblock title %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2>Zid Analytics Dashboard</h2>
      <p class="text-muted">Welcome, {{ user_name }} | Store: {{ store_title }}</p>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row text-center mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Total Orders</h5>
          <h3>{{ total_orders }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Total Products</h5>
          <h3>{{ total_products }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Total Revenue</h5>
          <h3>AED {{ total_revenue|floatformat:2 }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row mb-5">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Order Totals</h5>
          <canvas id="orderChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Top Products</h5>
          <canvas id="productChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <!-- Tables -->
  <div class="row">
    <div class="col-md-12">
      <h4>Recent Orders</h4>
      <div class="data-wrap">
        <div class="data-viewport">
          <div class="data-scroller" role="region" aria-label="Scrollable data table" tabindex="0">
            <table class="data-table" role="table" aria-label="Analytics dataset">
              <thead>
                <tr role="row">
                  <th scope="col" class="sticky-col sticky-corner">ID</th>
                  <th>Status</th>
                  <th>Total (AED)</th>
                  <th>Payment Status</th>
                  <th>Source</th>
                  <th>Created At</th>
                  <th>Updated At</th>
                </tr>
              </thead>
              <tbody>
                {% for o in orders %}
                <tr>
                  <td class="sticky-col">{{ o.id }}</td>
                  <td>{{ o.display_status }}</td>
                  <td>{{ o.order_total }}</td>
                  <td>{{ o.payment_status }}</td>
                  <td>{{ o.source }}</td>
                  <td>{{ o.created_at|date:"Y-m-d H:i" }}</td>
                  <td>{{ o.updated_at|date:"Y-m-d H:i" }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-12 mt-4">
      <h4>Sample Products</h4>
      <div class="data-wrap">
        <div class="data-viewport">
          <div class="data-scroller" role="region" aria-label="Scrollable data table" tabindex="0">
            <table class="data-table" role="table" aria-label="Analytics dataset">
              <thead>
                <tr role="row">
                  <th scope="col" class="sticky-col sticky-corner">Product</th>
                  <th>SKU</th>
                  <th>Price (AED)</th>
                </tr>
              </thead>
              <tbody>
                {% for p in products %}
                <tr>
                  <td class="sticky-col">
                    <img src="{{ p.display_image }}" alt="{{ p.display_name }}" class="img-thumbnail"
                      style="width: 50px; height: 50px;">
                    {{ p.display_name|truncatewords:3 }}
                  </td>
                  <td>{{ p.sku }}</td>
                  <td>{{ p.price }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart Data Injection -->
<script>
  const orderData = {
    labels: [{% for o in orders %}"#{{ o.id }}", {% endfor %}],
    datasets: [{
      label: 'Order Total (AED)',
      data: [{% for o in orders %}{{ o.order_total|floatformat:2 }}, {% endfor %}],
      backgroundColor: '#0099C699',
      borderColor: '#0099C6ff',
      hoverBackgroundColor: "#0099C6ff",
      borderRadius: {
        topLeft: 20,
        topRight: 20,
        bottomLeft: 0,
        bottomRight: 0
      },
      hoverBorderRadius: 10,
      borderWidth: 1,
      barPercentage: 0.9,
      categoryPercentage: 0.9,
      tension: 0.3
    }]
  };

  const productData = {
    labels: [{% for p in products %}"{{ p.display_name|truncatewords:3 }}", {% endfor %}],
    datasets: [{
      label: 'Product Prices (AED)',
      data: [{% for p in products %}{{ p.price|floatformat:2 }}, {% endfor %}],
      backgroundColor: '#99009999',
      borderColor: '#990099ff',
      hoverBackgroundColor: "#990099ff",
        borderRadius: {
          topLeft: 20,
          topRight: 20,
          bottomLeft: 0,
          bottomRight: 0
        },
      hoverBorderRadius: 10,
      borderWidth: 1,
      barPercentage: 0.9,
      categoryPercentage: 0.9,
      tension: 0.3,
    }]
  };

  const sharedOptions = {
    responsive: true,
    plugins: {
      legend: {
        position: 'top',
        labels: {
          font: {
            size: 14,
            weight: 'bold'
          }
        }
      },
      animation: {
        duration: 1000,
        easing: 'easeOutQuart',
        animateScale: true,
        animateRotate: true,
        animations: {
          borderRadius: {
            duration: 800,
            easing: 'easeOutCubic'
          }
        }
      },
      tooltip: {
        backgroundColor: '#333',
        titleColor: '#fff',
        bodyColor: '#eee',
        titleFont: {
          size: 14,
          weight: 'bold'
        },
        bodyFont: {
          size: 13
        },
        padding: 10,
        borderColor: '#888',
        borderWidth: 1
      },
      title: {
        display: false,
      }
    },
    scales: {
      x: {
        title: {
          display: false,
        },
        ticks: {
          display: false,
        },
        grid: {
          display: false
        }
      },
      y: {
        title: {
          display: true,
        },
        ticks: {
          display: true,
        },
        beginAtZero: true,
        ticks: {
          font: {
            size: 12
          }
        },
        grid: {
          display: false,
          color: 'rgba(200, 200, 200, 0.2)'
        }
      }
    }
  };


  const configOrder = {
    type: 'bar',
    data: orderData,
    options: sharedOptions
  };
  const configProduct = {
    type: 'bar',
    data: productData,
    options: sharedOptions
  };

  new Chart(document.getElementById('orderChart'), configOrder);
  new Chart(document.getElementById('productChart'), configProduct);
</script>

{% endblock %}